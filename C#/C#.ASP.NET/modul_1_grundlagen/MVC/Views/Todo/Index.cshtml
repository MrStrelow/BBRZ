@model List<MvcTodoApp.Models.Todo>
@{
    ViewData["Title"] = "Meine To-Do Liste";
}

<h1>@ViewData["Title"]</h1>

<h2>Neue Aufgabe hinzufügen</h2>
<form asp-controller="Todo" asp-action="Create" method="post">
    <input type="text" name="title" placeholder="Was muss getan werden?" required />
    <input type="submit" value="Hinzufügen" />
</form>

<ul>
    @if (!Model.Any())
    {
        <li>Keine Aufgaben mehr, sehr gut!</li>
    }
    else
    {
        @foreach (var todo in Model)
        {
            <li id="todo-@todo.Id">
                <a asp-controller="Todo" asp-action="Details" asp-route-id="@todo.Id">@todo.Title</a>
                <div class="actions">
                    <button type="button" class="delete" onclick="deleteTodo(@todo.Id)">Delete</button>
                </div>
            </li>
        }
    }
</ul>

@section Scripts {
    <script>
        function deleteTodo(id) {
            if (confirm('Sind Sie sicher, dass Sie diese Aufgabe löschen möchten?')) {
                fetch(`/Todo/Delete/${id}`, {
                    method: 'DELETE',
                }).then(response => {
                    if (response.ok) {
                        const todoElement = document.getElementById(`todo-${id}`);
                        if (todoElement) {
                            todoElement.remove();
                        }
                    } else {
                        alert('Fehler beim Löschen der Aufgabe.');
                    }
                }).catch(error => console.error('Fehler beim Löschen:', error));
            }
        }
    </script>
}