@model (List<Menu> Menus, List<Dish> Dishes, List<Bill> Bills, SelectList Customers, SelectList Tables);

@{
    ViewData["Title"] = ViewBag.Title;
}

<h1 class="mb-4">@ViewData["Title"]</h1>

<div class="form-section mb-5">
    <h2 class="mb-3">Neue Bestellung aufgeben</h2>
    <form asp-controller="Fruehstueck" asp-action="Bestellen" method="post">
        @Html.AntiForgeryToken()
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="customerId" class="form-label">Kunde</label>
                <select name="customerId" class="form-select" asp-items="Model.Customers"></select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="tableId" class="form-label">Tisch Nr.</label>
                <select name="tableId" class="form-select" asp-items="Model.Tables"></select>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Menüs auswählen</label>
                <div class="border rounded p-3 bg-light" style="max-height: 200px; overflow-y: auto;">
                    @foreach (var menu in Model.Menus)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="selectedMenuIds" value="@menu.Id" id="menu-@menu.Id">
                            <label class="form-check-label" for="menu-@menu.Id">
                                @menu.Name (@menu.Price.ToString("C"))
                            </label>
                        </div>
                    }
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Einzelne Gerichte (A la carte)</label>
                <div class="border rounded p-3 bg-light" style="max-height: 200px; overflow-y: auto;">
                    @foreach (var dish in Model.Dishes)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="selectedDishIds" value="@dish.Id" id="dish-@dish.Id">
                            <label class="form-check-label" for="dish-@dish.Id">
                                @dish.Name (@dish.Price.ToString("C"))
                            </label>
                        </div>
                    }
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary mt-3">Bestellung aufgeben</button>
    </form>
</div>

<div class="list-section">
    <h2 class="mb-3">Bisherige Rechnungen</h2>
    @if (Model.Bills.Any())
    {
        <div class="accordion" id="billsAccordion">
            @foreach (var bill in Model.Bills)
            {
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading-@bill.Id">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-@bill.Id">
                            <strong>Rechnung #@bill.Id</strong> &nbsp;- Tisch @bill.Visit.Table.TableNumber - @bill.Visit.Customers.FirstOrDefault()?.Name - Betrag: @bill.TotalAmount.ToString("C")
                        </button>
                    </h2>
                    <div id="collapse-@bill.Id" class="accordion-collapse collapse" data-bs-parent="#billsAccordion">
                        <div class="accordion-body">
                            <p><strong>Datum:</strong> @bill.BillDate.ToString("g")</p>
                            <h6>Bestellung:</h6>
                            <ul>
                                @foreach (var order in bill.Visit.Orders)
                                {
                                    foreach (var menu in order.Menus)
                                    {
                                        <li>@menu.Name (Menü)</li>
                                    }
                                    foreach (var dish in order.Dishes)
                                    {
                                        <li>@dish.Name (Gericht)</li>
                                    }
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info" role="alert">
            Noch keine Rechnungen vorhanden.
        </div>
    }
</div>