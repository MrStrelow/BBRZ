# Umgang mit Visual Studio und .NET Projekten

Wir unterscheiden zwicshen einer ``Solution`` und einem ``Project``. Hier sind die deutschen Begriffe aussagekräftiger. Die ``Solution`` ist die ``Projektmappe`` und ein ``Project`` ist ein ``Projekt``. Eine ``Solution`` enthält also mehrere ``Projekte``. Warum aber?

Ein folgendes technisches Beispiel. Wenn wir 
* große Projekte, 
* mit mehreren Mitarbeitern und
* verschiedenen Technologien/Sprachen haben, ist es Vorteilhaft diese in eigene Projekte zu packen. 

Wir bleiben hier in C#, jedoch unterteilen:
* ein Projekt mit Namen *MeineWebApp.Web* für die Userinteraktion (Client) welche Anfragen an den Server übers Internet sendet (MVC mit ASP.NET - siehe Webprogrammierung),
* ein Projekt mit Namen *MeineWebApp.Core* welches Schnittstellen zur ``BusinessLogik`` geben und
* in das 3. Projekt die ``Datenbank`` packen.

Wir zwingen damit den Programmiereer mit den Ressourcen zu arbeiten welche dieser sehen darf. Nicht alles aus einem Projekt kann ein anderes Projekt sehen.

Das Würde so aussehen.
```
/MeineWebApp.sln
│
├── /MeineWebApp.Web/           (die Präsentationsschicht)
│   ├── Controllers/            (die http requests)
│   ├── ViewModels/             (was bekommt die cshtml Dateien)
│   ├── Views/                  (die cshtml Datein)
│   └── MeineWebApp.Web.csproj  (kennt das MeineWebApp.Core Projekt!)
│
├── /MeineWebApp.Core/          (die Geschäftslogik - abstrakt)
│   ├── Models/                 (Entities - wie Kunde, Schichtleiter, ...)
│   ├── Services/               (Interfaces der Services, z.B. IRestaurantService mit dem ein Tisch gebucht werden kann)
│   └── MeineWebApp.Core.csproj (Kennt keine anderen Projekte!)
│
└── /MeineWebApp.Infrastructure/  (der Datenzugriff und die Geschäftslogik - konkret)
    ├── Data/                   (DbContext, Migrationen, die konkrekte Datenbank)
    ├── Services/               (z.B. RestaurantService steht der Code für Tisch buchen.)
    └── MeineWebApp.Infrastructure.csproj (kennt das Projekt MeineWebApp.Core)
```

**Wir nutzen das für unsere Exercises (auf github-classroom) und Mitschriften.**

Ich empfehle folgendes - zuerst nur allgemein und im nächsten [Kapitel](#erstellen-der-solutions-und-projekte-mit) mit den konkreten Schritten:
1) Für Übungen von Github-Classroom:
    * Eine ``Solution`` pro Modul z.B. *Modul1_Exercises*. (Wir haben 5 Module im Programmiern.)
    * In einer ``Solution`` ist jede *Exercise* von Github-Classroom ein ``Projekt``.
2) Für Mitschriften wenn wir gemeinsam Programmieren:
    * Eine ``Solution`` pro Modul z.B. *Modul1_Mitschrift*. (Wir haben 5 Module im Programmiern.)
    * In einer ``Solution`` ist jedes *Programm was wir gemeinsam schreiben* ein ``Projekt``. Ihr findet meine Versoin davon in den *LiveCoding* Ordner auf meinem [Github](../../../../C#.NET/).

Aber wie erstellen wir diese Projekte in den Solution für die einzelnen Module? 

## Erstellen der Solutions und Projekte mit...
### ... Visual Studio (VS) mit der grafischen Oberfläche (GUI)

#### Für Exercieses und Github Classroom
1) **Eine Leer Solution ohne Projekte erstellen**
Gehe über das Menü auf **Datei -> Neu -> Projekt** *(File -> New -> Project)* und wähle eine Vorlage mit Namen **Blank Solution**. Benenne die ``Solution`` z.B. *Modul1_Exercises*. Verwende die Suche und gib dort **Leere Projektmappe** oder **Blank Solution** ein. Akeptiere alles und beende den Dialog.
Wiederhole für *Modul1_Mitschrift*.

2) **Github-Classroom repo clonen**
Öffne in VS das *Developer-Terminal* unter **View -> Terminal**. Gib dort *git --version* ein um zu erkennen, ob git installiert ist. Verwende nun [diese Datei](../../repositories-für-exercises.md) und drücke auf den *Repository Link* der gewünschten Excercise. Akzeptiere die Excercise und drücke anschließend auf den dort erstellten Link. Kopiere den Link für *git clone*, welcher durch drücken des grünen ``<> Code``-Buttons rechts oben erreichbar ist. Wechsle nun nach VS in das *Developer-Terminal*. Der Pfad im *Developer-Terminal* sollte in dem Ordner mit dem Namen der ``Solution`` sein (``PS C:\..PfadDesUsers..\Modul1_Exercises``). Clone nun dieses Repository mit ``git clone ~~~irgendeineURL~~~.git``. Wichtig, der Link muss *.git* enthalten. Es wird ein Ordner welcher z.B. *M1L2Exercise1-MusterUndDessenLogischeFormeln* heißt erstellt.

3) **Ein Projekt welche der Solution hinzugefügt wird**
Drücke dazu rechts auf die Solution im **Solution Explorer** *(Projektmappen Explorer)* und **Add -> new Project** *(Hinzufügen -> neues Projekt)*. Falls kein **Solution Explorer** rechts sichtbar ist, blende diese in **View -> Solution Explorer** ein. Wähle nun eine Vorlage (für uns fast immer *Console App* *(Konsolen Applikation)* - **ohne Framework im Namen!**). Gib dieser einen Namen z.B. *Ex1MusterUndLogischeFormeln*. **Wichtig!**. Wähle nun in Location den Ordner des geklonten ``Repositories`` aus. Drücke solagne weiter bis der Dialog beendet ist.

Wiederhole nun 2) und 3) für jede Excecise in dem Modul1. Wiederhole 1), 2) und 3) für eine neues Modul.

Nun kann mit den git-Befehlen gearbeitet werden um die Aufgabe abzugeben. Verwende dazu die in [diesem Ornder](../../L00Git/) erklärten Befehle ``git add -A``, ``git commit -m "meine sinnvolle nachricht um den commit zu beschreiben"`` und ``git push.``, um die gelöste Aufgabe abzugeben.

#### Für Mitschriften
Kursgefasst: Wie für [Exercises](#für-exercieses-und-github-classroom), nur ohne dem Clonen des Repositories und des daurch entstehenden Unterordners.

**Anmekrung:** Wer keinen extra unterordner habne will, muss die [Konsolenbefehle](#-mit-der-console-für-jene-die-vs-code-verwenden-wollen-optional) mit *-o* verwenden oder in den .sln-Dateien die Pfade händisch ändern. Eine für euch maßgeschneiderte Anleitung bzw. die umgeschriebene sln-Datei gibt euch ein Chatbot eurer Wahl.

### ... Mit der Console für jene die VS-Code verwenden wollen **(Optional)**
Lies zuerst die Anleitung für die [grafische Oberfläche](#-visual-studio-vs-mit-der-grafischen-oberfläche-gui) **grob** durch, da hier nicht alles so ausführlich wiederholt ist.

#### Für Exercieses und Github Classroom

Öffne ein Terminal (in VS-Code unter **Terminal**). Öffne dort die ``Git-Bash``.

**1) Eine leere Solution ohne Projekte erstellen**
Navigiere im Terminal in den Ordner, in dem du deine Arbeit für das Modul speichern möchtest (z.B. `C:\Users\...OneDrive\`). Führe dann folgenden Befehl aus:
```shell
dotnet new sln -n Modul1_Exercises
```
Dieser Befehl erstellt eine einzelne Datei namens `Modul1_Exercises.sln`. Das ist der "Container" für all deine Übungsprojekte dieses Moduls.

**2) Github-Classroom Repo klonen**
Bleibe im selben Ordner (wo die `.sln`-Datei liegt). Klone nun das Repository von GitHub Classroom aus folgender [Datei](../../repositories-für-exercises.md). Mehr Infos dazu [hier](#-visual-studio-vs-mit-der-grafischen-oberfläche-gui) von der GUI-Anleitung mit VS.
```shell
git clone <deine-github-repo-url>.git
```
Dadurch wird ein neuer Ordner erstellt, der den Namen des Repositories trägt (z.B. `M1L2Exercise1-MusterUndDessenLogischeFormeln`). Dies ist bereits dein zukünftiger Projektordner.

**3) Ein Projekt im geklonten Ordner erstellen (ohne Unterordner!)**
Dies ist der entscheidende Schritt. Wechsle zuerst in den Ordner des geklonten Repositories:
```shell
cd m1l2exercise1-mustermuster
```
Erstelle jetzt das Projekt direkt in diesem Ordner mit dem `-o .` Parameter. Das `.` steht für "aktueller Ordner".
```shell
# Für eine Konsolenanwendung. Ersetze 'console' bei Bedarf (z.B. durch 'classlib').
dotnet new console -o .
```
Jetzt liegt die `.csproj`-Datei direkt im Hauptverzeichnis deines Git-Repos, genau wie gewünscht.

**4) Das Projekt zur Solution hinzufügen**
Wechsle im Terminal wieder eine Ebene nach oben in den Ordner, in dem deine Solution-Datei liegt:
```shell
cd ..
```
Füge nun das Projekt, das du in Schritt 3 erstellt hast, zu deiner Solution hinzu. Du musst den Pfad zur `.csproj`-Datei angeben.
```shell
dotnet sln add ./m1l2exercise1-mustermuster/m1l2exercise1-mustermuster.csproj
```
Wenn du jetzt die `Modul1_Exercises.sln` in Visual Studio öffnest, siehst du das Projekt sauber und ohne verschachtelte Ordner eingebunden.

**Wiederhole die Schritte 2 bis 4 für jede weitere Exercise in diesem Modul.**

#### Für Mitschriften

Der Prozess ist fast identisch, nur dass du das Repository nicht klonst, sondern den Ordner selbst erstellst.

1.  **Solution erstellen** (falls noch nicht geschehen):
    ```shell
    dotnet new sln -n Modul1_Mitschrift
    ```
2.  **Projektordner erstellen** und hineinwechseln:
    ```shell
    mkdir L01_ErsteSchritte
    cd L01_ErsteSchritte
    ```
3.  **Projekt im Ordner erstellen**:
    ```shell
    dotnet new console -o .
    ```
4.  **Projekt zur Solution hinzufügen**:
    ```shell
    cd ..
    dotnet sln add ./L01_ErsteSchritte/L01_ErsteSchritte.csproj
    ```

### Automatisierung als Skript
Hier noch ein kleines ``Shell-Script`` (.sh) welches die Befehle zusammenfasst.
Wir haben zwei Ausführungsmöglichkeiten:
1) Für eine ``Solution`` welches die ``Projekte`` basierend auf der github-classroom exercise holt. Das wird mit dem --github flag eingeschalten und es muss statt dem namen des projekts der Repolink angegeben werden. Das ist der Link, welcher für ``git clone`` verwendet wird. (Beispiele siehe unten)
2) Für allgemeine ``Solutions`` mit ``Projekte``.

Weiters kann:
1) Eine neue ``Solution`` erstellt werden und mit projekten befüllt werden, oder
2) eine bereits bestehende ``Solution`` mit weiteren ``Projekten`` werden erweitert werden. Funktioniert auch für ``Repositories`` aus Github welche dann ``Projekte`` werden. 

```bash
#!/bin/sh
set -eu

# ==============================================================================
# Erstellt eine .NET Solution und fügt Projekte hinzu.
# Kompatibel mit der einfachen Bourne Shell (sh).
#
# STANDARD-NUTZUNG (Projekte manuell erstellen):
#   sh what.sh "<SolutionName>" "App:console" "Core:classlib"
#
# GITHUB-NUTZUNG (Projekte aus Repos klonen):
#   sh what.sh --github "<SolutionName>" <RepoURL1> <RepoURL2> ...
# ==============================================================================

# --- 1. Argumente und System prüfen ---

if [ "$#" -lt 2 ]; then
  echo "Fehler: Unzureichende Argumente."
  echo "Verwendung (Standard): $0 <SolutionName> <Project[:type]> [weitere ...]"
  echo "Verwendung (GitHub):   $0 --github <SolutionName> <RepoURL> [weitere URLs...]"
  exit 1
fi

if ! command -v dotnet >/dev/null 2>&1; then
  echo "Fehler: 'dotnet' nicht gefunden. .NET SDK installieren: https://dotnet.microsoft.com/download"
  exit 1
fi
if ! command -v git >/dev/null 2>&1; then
  echo "Fehler: 'git' nicht gefunden. Git installieren: https://git-scm.com/download"
  exit 1
fi

# --- 2. Modus bestimmen und Variablen setzen ---

GITHUB_MODE="false"
if [ "$1" = "--github" ]; then
  GITHUB_MODE="true"
  shift # Entfernt den --github Schalter aus der Argumentenliste
fi

SOLUTION_NAME="$1"
shift # Entfernt den Solution-Namen aus der Argumentenliste

# --- 3. Solution-Struktur anlegen ---

mkdir -p "$SOLUTION_NAME"
cd "$SOLUTION_NAME"

if [ -f "$SOLUTION_NAME.sln" ]; then
  echo "Hinweis: Solution '$SOLUTION_NAME.sln' existiert bereits – wird verwendet."
else
  echo "-> Erstelle Solution '$SOLUTION_NAME'..."
  dotnet new sln -n "$SOLUTION_NAME"
fi

# --- 4. Projekte basierend auf dem Modus erstellen (in einer Schleife) ---

while [ "$#" -gt 0 ]; do
  item="$1"

  if [ "$GITHUB_MODE" = "true" ]; then
    # --- GITHUB-MODUS ---
    REPO_URL="$item"
    # Extrahiert den Namen aus der URL (z.B. .../mein-repo.git -> mein-repo)
    NAME=$(basename "$REPO_URL" .git)
    TYPE="console" # Standard-Projekttyp für geklonte Repos. Kann später geändert werden.
    
    echo "-> Klonen von Git-Repository '$NAME' aus $REPO_URL..."
    if [ -d "$NAME" ]; then
        echo "   Verzeichnis '$NAME' existiert bereits – überspringe Klonen."
    else
        git clone "$REPO_URL" "$NAME"
    fi
    PROJ_DIR="$NAME"

  else
    # --- STANDARD-MODUS ---
    # Zerlegt "Name:typ" mit POSIX-kompatibler Syntax
    if echo "$item" | grep -q ':'; then
        NAME=$(echo "$item" | cut -d: -f1)
        TYPE=$(echo "$item" | cut -d: -f2)
    else
        NAME="$item"
        TYPE="console" # Default-Typ
    fi
    
    echo "-> Erstelle Projekt '$NAME' (Typ: $TYPE) ..."
    PROJ_DIR="$NAME"
    mkdir -p "$PROJ_DIR"
  fi

  # --- Gemeinsame Logik: .NET-Projekt anlegen (falls nötig) und zur Solution hinzufügen ---
  CSPROJ_PATH="$PROJ_DIR/$NAME.csproj"
  
  if [ -f "$CSPROJ_PATH" ]; then
    echo "   .NET-Projekt existiert bereits – überspringe Erstellung."
  else
    echo "   Erstelle .NET-Projekt '$NAME' (Typ: $TYPE) im Verzeichnis..."
    dotnet new "$TYPE" -n "$NAME" -o "$PROJ_DIR"
  fi
 
  # Prüft, ob das Projekt bereits in der .sln-Datei gelistet ist
  if dotnet sln list 2>/dev/null | grep -q "$PROJ_DIR"; then
    echo "   Projekt ist bereits in der Solution registriert."
  else
    echo "   Füge Projekt '$NAME' zur Solution hinzu..."
    dotnet sln "$SOLUTION_NAME.sln" add "$CSPROJ_PATH"
  fi

  shift # Gehe zum nächsten Argument in der Liste
done

# --- 5. Finale Schritte ---

echo ""
echo "-> Führe dotnet restore & build aus..."
dotnet restore
dotnet build --no-logo

echo ""
echo "✅ Fertig. Solution & Projekte:"
dotnet sln "$SOLUTION_NAME.sln" list || true

echo ""
echo "Öffne '$SOLUTION_NAME.sln' in Visual Studio (Code)."
```

Wir können nun in der ***``Git-Bash``*** das shell-script aufrufen.

1) für solutions mit projekten mit --github
```
sh create_solution.sh --github Modul1_exercises https://github.com/MyComputingAdventures/m1l2exercise1-musterunddessenlogischeformeln-EUERNAME.git https://github.com/MyComputingAdventures/m1l2exercise2-auswertungsreihenfolge-EUERNAME.git https://github.com/MyComputingAdventures/m1l2exercise3-primitivetypenumwandeln-EUERNAME.git 
```
2) für solutions mit projekten ohne --github
```
sh create_solution.sh MeineFirma HauptAnwendung Logikbibliothek TestProjekt
```

Es kann nun die Datei `MeineAnwendung.sln` mit doppel-klick oder in Visual Studio öffnen, und die IDE wird die Solution inklusive beider Projekte korrekt laden, als hätten Sie alles von Anfang an in der GUI erstellt.

---

### Top-Level Statements und Main-Methode
Die Solution `Modul1-LiveCoding` könnte mehrere Projekte enthalten, die sich mit den Themen aus Modul 1 beschäftigen.

**Wichtig:** Jedes Projekt kann nur **einen** Einstiegspunkt haben. Das bedeutet, nur ein Projekt kann eine `Main`-Methode (oder ein Top-Level-Statement) enthalten, das beim Starten der Anwendung ausgeführt wird.

Hier ist ein Beispiel für ein Top-Level-Statement:
```csharp
uint[] zahlen = [28, 26, 6, 4, 2];
uint platzhalter = 10; //uint ist ein unsigned int, bedeutet es hab nur positive zahlen. 

for (int j = 0; j < zahlen.Length - 1; j++)
{
    Console.WriteLine($"{j + 1} Durchlauf");    // Das $ kennzeichnet einen formatted String. Dieser erlaubt eine string-interpolation. Wir können dadurch innerhalb der geschwungenen Klammern {} C# code angeben.
}
```

Hier ist ein Beispiel für eine Klasse mit Main-Methode:
```csharp
// Das Ffile heißt z.B. Programm.cs - hier muss die Klasse nicht den gleichen Namen haben wie das File. 
public class Zahlen {
    public static void Main() { // Achtung! Methoden werden in C# groß geschrieben! Zudem kann, muss aber nicht ein string[] args übergeben werden. string wird hier klein geschrieben und ist die Abkürzung von System.String. Gleich wie int vs. System.Int32. Ansonsten sind Klassen groß geschreiben z.b. List<...>.
        uint[] zahlen = [28, 26, 6, 4, 2];
        uint platzhalter = 10; //uint ist ein unsigned int, bedeutet es hab nur positive zahlen. 

        for (int j = 0; j < zahlen.Length - 1; j++)
        {
            Console.WriteLine($"{j + 1} Durchlauf");    // Das $ kennzeichnet einen formatted String. Dieser erlaubt eine string-interpolation. Wir können dadurch innerhalb der geschwungenen Klammern {} C# code angeben.
        }
    }
}
```

## Nützliche Konsolenbefehle

Die .NET CLI (Command Line Interface) bietet Befehle zum Verwalten von .NET-Projekten. Hier sind einige der wichtigsten:

* **Bauen (Build):**
    * Befehl: `dotnet build`
    * Dieser Befehl kompiliert das Projekt im aktuellen Verzeichnis.
    * Grafisch in VS: **Build -> Build Solution** (Erstellen -> Projektmappe erstellen)

* **Bereinigen (Clean):**
    * Befehl: `dotnet clean`
    * Dieser Befehl löscht die Ausgabe des letzten Builds.
    * Grafisch in VS: **Build -> Clean Solution** (Erstellen -> Projektmappe bereinigen)

* **Ausführen (Run):**
    * Befehl: `dotnet run`
    * Dieser Befehl baut das Projekt und führt es aus.
    * Grafisch in VS: **Debug -> Start Debugging** (Debuggen -> Debugging starten) oder **Debug -> Start Without Debugging** (Debuggen -> Starten ohne Debuggen)

## Tipps

* **Ein Projekt wird nicht erkannt:**
    * Öffnen Sie die `.sln`-Datei mit einem Texteditor wie Visual Studio Code (nicht Visual Studio!).
    * Überprüfen Sie die Dateipfade zu den Projekten (`.csproj`-Dateien) und stellen Sie sicher, dass sie korrekt sind.
    * Beispiel einer `.sln`-Datei:
    ```
    Microsoft Visual Studio Solution File, Format Version 12.00
    # Visual Studio Version 17
    VisualStudioVersion = 17.0.31903.59
    MinimumVisualStudioVersion = 10.0.40219.1
    Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "MeinProjekt", "MeinProjekt\MeinProjekt.csproj", "{DE9A4240-A51A-4AF4-B849-B4886D6B6082}"
    EndProject
    Global
        ...
    EndGlobal
    ```

* **Git verwenden:**
    * Verwenden Sie die **Developer PowerShell** in Visual Studio für Git-Befehle. Diese ist bereits mit den notwendigen Werkzeugen konfiguriert.
    * Sie finden diese unter **View -> Terminal** (Ansicht -> Terminal)

* **Solution Explorer (Projektmappen-Explorer):**
    * Der **Solution Explorer** (Projektmappen-Explorer) ist standardmäßig auf der rechten Seite von Visual Studio zu finden.
    * Er zeigt die hierarchische Struktur Ihrer Solution und der darin enthaltenen Projekte an.

# Abgaben auf GitHub Classroom

Die Abgabe der Aufgabe erfolgt über GitHub Classroom. Der Prozess läuft folgendermaßen ab:

1.  **Aufgabe annehmen:**
    * Klicken Sie auf den bereitgestellten Link: z.B. [https://classroom.github.com/a/mmR_Rtq3](https://classroom.github.com/a/mmR_Rtq3)
    * Sie werden aufgefordert, die Aufgabe anzunehmen. Dadurch wird ein privates Repository für Sie auf GitHub erstellt, das eine Kopie der Aufgabenstellung enthält.

2.  **Repository klonen:**
    * Nachdem das Repository erstellt wurde, klonen Sie es auf Ihren lokalen Computer. Sie finden die URL zum Klonen auf der Seite Ihres Repositories auf GitHub.
    * Verwenden Sie den Befehl `git clone <repository_url>` in der Developer PowerShell oder einem anderen Terminal.

3.  **Aufgabe bearbeiten:**
    * Öffne das geklonte Projekt in Visual Studio.
    * Erstelle dort eine Soltion mit einem Projekt.
    * Beginn dort die Aufgabe zu lösen.

4.  **Änderungen committen und pushen:**
    * Wenn Sie mit Ihrer Lösung zufrieden sind, committen Sie Ihre Änderungen und pushen Sie sie zu Ihrem GitHub-Repository.
    * Verwenden Sie die folgenden Git-Befehle:
        ```bash
        git add .
        git commit -m "Aufgabe 1: Erster Lösungs Versuch."
        git push
        ```

5.  **Automatischer Test:**
    * Sobald Sie Ihre Änderungen gepusht haben, wird ein automatisierter Test in Ihrem GitHub-Repository ausgeführt.
    * Sie können den Fortschritt und das Ergebnis des Tests im "Actions"-Tab Ihres Repositories verfolgen.
    * Der Test überprüft, ob Ihre Lösung die in der Aufgabenstellung definierten Kriterien erfüllt. Wenn der Test fehlschlägt, können Sie weitere Änderungen vornehmen, committen und pushen, um den Test erneut auszuführen.